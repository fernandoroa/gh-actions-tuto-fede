{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"1. Introduction","text":"<p>A modification of the Microsoft tutorial, to use Federated ID Pages (left) refer to youtube video parts</p>"},{"location":"#1-introduction-to-tutorial","title":"1. Introduction to tutorial","text":"<p>00:00 - 01:54</p>"},{"location":"#links","title":"Links","text":"<p>00:00 - https://github.com/Azure/arm-deploy/commit/a1361c2c2cd398621955b16ca32e01c65ea340f5 00:11 - https://learn.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest 00:27 - https://learn.microsoft.com/en-us/training/modules/learn-continuous-integration-github-actions/10-implement-github-actions-for-ci-cd 00:40 - https://microsoftlearning.github.io/AZ400-DesigningandImplementingMicrosoftDevOpsSolutions/Instructions/Labs/AZ400_M02_L05_Implement_GitHub_Actions_for_CI_CD.html 01:11 - https://github.com/new/import</p>"},{"location":"#requirements","title":"Requirements:","text":"<ol> <li> <p>Azure Account</p> <ul> <li>In browser, search for keywords: \"azure login\"</li> <li>Personal Account Recommended (instead of scholar)</li> <li>\"Free\" Subscription (trial needs Credit Card)</li> </ul> </li> <li> <p>Microsoft Entra</p> <ul> <li>login url: https://entra.microsoft.com</li> </ul> </li> <li> <p>Github Account</p> </li> </ol>"},{"location":"#exercise-0","title":"Exercise 0:","text":""},{"location":"#task-1","title":"Task 1","text":"<ol> <li> <p>Go to: https://github.com/new/import</p> <ul> <li> <p>URL for your source repository:</p> <pre><code>https://github.com/MicrosoftLearning/eShopOnWeb\n</code></pre> </li> <li> <p>Your username / access token: <code> </code> (empty)</p> </li> <li>Repository Name: <code>eShop</code> (example)</li> </ul> </li> </ol>"},{"location":"page2/","title":"2. Resource Group","text":"<p>Pages (left) refer to youtube video parts</p>"},{"location":"page2/#2-create-resource-group-and-system-variables","title":"2. Create Resource Group and System Variables","text":"<p>01:55 - 04:09</p>"},{"location":"page2/#links","title":"Links","text":"<p>02:32 - https://learn.microsoft.com/en-us/azure/app-service/quickstart-multi-container 04:03 - https://learn.microsoft.com/en-us/cli/azure/install-azure-cli-linux?pivots=apt</p>"},{"location":"page2/#requirements","title":"Requirements:","text":"<ol> <li> <p>Azure CLI</p> <ul> <li>https://learn.microsoft.com/en-us/cli/azure/install-azure-cli-linux?pivots=apt</li> </ul> </li> </ol>"},{"location":"page2/#exercise-1","title":"Exercise 1:","text":""},{"location":"page2/#task-1-cli-equivalent","title":"Task 1 (CLI equivalent)","text":"<ol> <li> <p>login to Azure CLI:</p> <ul> <li> <p>create .json file</p> <pre><code>\u276f az login &gt; login.json\n</code></pre> </li> <li> <p>continue login process on browser</p> </li> <li> <p>contents of .json</p> <pre><code>\u276f cat login.json\n</code></pre> </li> </ul> </li> <li> <p>Save secrets locally (these SECRETS are for later):</p> <ul> <li> <p>From .json to system variable:</p> <pre><code>\u276f export AZURE_SUBSCRIPTION_ID=$(awk 'BEGIN { FS=\"\\\"\"; RS=\",\" }; { if ($2 == \"id\") {print $4} }' login.json)\n\u276f echo $AZURE_SUBSCRIPTION_ID\n</code></pre> </li> <li> <p>From .json to system variable:</p> <pre><code>\u276f export AZURE_TENANT_ID=$(awk 'BEGIN { FS=\"\\\"\"; RS=\",\" }; { if ($2 == \"tenandId\") {print $4} }' login.json)\n\u276f echo $AZURE_TENANT_ID\n</code></pre> </li> </ul> </li> <li> <p>Create Resource Group</p> <ul> <li> <p>Save name to system variable:</p> <pre><code>\u276f export AZURE_ESHOP_RESOURCE_GROUP=rg-eshoponweb-federated\n\u276f echo $AZURE_ESHOP_RESOURCE_GROUP\n</code></pre> </li> <li> <p>Create group:</p> <pre><code>\u276f az group create --name $AZURE_ESHOP_RESOURCE_GROUP --location \"South Central US\" &gt; group.json\n</code></pre> </li> </ul> </li> </ol>"},{"location":"page3/","title":"3. App, SP, Role","text":"<p>Pages (left) refer to youtube video parts</p>"},{"location":"page3/#3-create-app-service-principal-and-role","title":"3. Create App, Service Principal and Role","text":"<p>04:10 - 06:07</p>"},{"location":"page3/#links","title":"Links","text":"<p>04:36 - https://learn.microsoft.com/en-us/azure/developer/github/connect-from-azure?tabs=azure-cli%2Clinux</p>"},{"location":"page3/#exercise-1","title":"Exercise 1:","text":""},{"location":"page3/#task-1-cli-equivalent-of-steps-5-to-8","title":"Task 1 (CLI equivalent of steps 5 to 8)","text":"<ol> <li> <p>Provider:</p> <pre><code>\u276f az provider register --namespace Microsoft.Web\n</code></pre> </li> <li> <p>Create App:</p> <ul> <li> <p>get <code>.json</code> file</p> <pre><code>\u276f export myApp=eShop\n\u276f az ad app create --display-name $myApp &gt; app.json\n</code></pre> </li> <li> <p>get <code>APP_ID</code> from <code>.json</code> file</p> <pre><code>\u276f export APP_ID=$(awk 'BEGIN { FS=\"\\\"\"; RS=\",\" }; { if ($2 == \"appId\") {print $4} }' app.json)\n\u276f echo $APP_ID\n</code></pre> </li> </ul> </li> <li> <p>Create the Service Principal:</p> <ul> <li> <p>get <code>.json</code> file</p> <pre><code>\u276f az ad sp create --id $APP_ID &gt; service.json\n</code></pre> </li> <li> <p>get <code>SP_ID</code> from <code>.json</code> file</p> <pre><code>\u276f export SP_ID=$(awk 'BEGIN { FS=\"\\\"\"; RS=\",\" }; { if ($2 == \"id\") {print $4} }' service.json)\n\u276f echo $SP_ID\n</code></pre> </li> </ul> </li> <li> <p>Create Role Assignment:</p> <pre><code>\u276f az role assignment create --role contributor --subscription $AZURE_SUBSCRIPTION_ID \\\n--assignee-object-id $SP_ID --assignee-principal-type ServicePrincipal \\\n--scope /subscriptions/$AZURE_SUBSCRIPTION_ID/resourceGroups/$AZURE_ESHOP_RESOURCE_GROUP &gt; role.json\n</code></pre> </li> </ol>"},{"location":"page4/","title":"4. Secrets","text":"<p>Pages (left) refer to youtube video parts</p>"},{"location":"page4/#4-add-secrets-to-github-and-create-federated-id","title":"4. Add Secrets to Github and Create Federated ID","text":"<p>06:08 - 07:48</p>"},{"location":"page4/#requirements","title":"Requirements:","text":"<ol> <li> <p>xclip or equivalent</p> <pre><code>\u276f sudo apt install xclip\n</code></pre> </li> <li> <p>nano editor or any text editor</p> </li> </ol>"},{"location":"page4/#exercise-1","title":"Exercise 1:","text":""},{"location":"page4/#task-1-cli-equivalent-of-steps-9-to-11","title":"Task 1 (CLI equivalent of steps 9 to 11)","text":"<ol> <li> <p>Copy SECRETS to the clipboard and paste them in Github:</p> <ul> <li> <p>paste the <code>AZURE_SUBSCRIPTION_ID</code> value in Github / Settings / Secrets and Variables / Actions</p> <pre><code>\u276f echo $AZURE_SUBSCRIPTION_ID | xclip -selection clipboard\n</code></pre> </li> <li> <p>paste the <code>APP_ID</code> value as <code>AZURE_CLIENT_ID</code> in Github / Settings / Secrets and Variables / Actions</p> <pre><code>\u276f echo $APP_ID | xclip -selection clipboard\n</code></pre> </li> <li> <p>paste the <code>AZURE_TENANT_ID</code> value in Github / Settings / Secrets and Variables / Actions</p> <pre><code>\u276f echo $AZURE_TENANT_ID | xclip -selection clipboard\n</code></pre> </li> </ul> </li> <li> <p>Create the federated Identity</p> <ul> <li> <p>create the credential.json file</p> <pre><code>\u276f nano credential.json\n</code></pre> </li> <li> <p>Content: (update with your repository data)</p> credential.json<pre><code>{\n  \"name\": \"federated_id\",\n  \"issuer\": \"https://token.actions.githubusercontent.com\",\n  \"subject\": \"repo:fernandoroa/eShop:environment:Development\",\n  \"description\": \"Testing\",\n  \"audiences\": [\"api://AzureADTokenExchange\"]\n}\n</code></pre> </li> <li> <p>Federated identity command:</p> <pre><code>\u276f az ad app federated-credential create --id $APP_ID --parameters credential.json &gt; federated.json\n</code></pre> </li> </ul> </li> </ol>"},{"location":"page5/","title":"5. Workflow","text":"<p>Pages (left) refer to youtube video parts</p>"},{"location":"page5/#5-modify-workflow-and-commit-changes-deployment","title":"5. Modify Workflow and commit changes, deployment","text":"<p>07:49 - end</p>"},{"location":"page5/#requirements","title":"Requirements:","text":""},{"location":"page5/#exercise-1","title":"Exercise 1:","text":""},{"location":"page5/#task-2-modified","title":"Task 2 (modified)","text":"<ol> <li> <p>Remove unnecessary file to avoid some errors:</p> <ul> <li>Go to Code tab in Github</li> <li>Navigate to <code>.github/workflows/dotnetcore.yml</code></li> <li>Click on <code>...</code> menu (top right)</li> <li>Click on <code>Delete file</code></li> <li>Click on <code>Commit Changes</code> button</li> </ul> </li> <li> <p>Update <code>eshoponweb-cicd.yml</code></p> <ul> <li>Navigate to <code>.github/workflows/eshoponweb-cicd.yml</code></li> <li> <p>Uncomment line 4: <code>on: [push, ...]</code></p> </li> <li> <p>Add id-token permissions:   Add this after <code>on:</code> line</p> eshoponweb-cicd.yml<pre><code>permissions:\n  contents: read\n  id-token: write\n</code></pre> </li> <li> <p>Update <code>env:</code> section:</p> <ul> <li>Remove line with <code>SUBSCRIPTION-ID</code>, it should be a secret</li> <li>For <code>RESOURCE-GROUP</code>, use <code>rg-eshoponweb-federated</code>, as in command line, previously</li> <li>For <code>WEBAPP-NAME</code>, use a globally unique name, i.e. <code>eShop-unique-1546</code></li> </ul> </li> <li> <p>In the <code>login</code> step:</p> <ul> <li>remove <code>creds:</code> key line</li> <li> <p>add:</p> eshoponweb-cicd.yml<pre><code>client-id: ${{ secrets.AZURE_CLIENT_ID }}\ntenant-id: ${{ secrets.AZURE_TENANT_ID }}\nsubscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}\n</code></pre> </li> </ul> </li> <li> <p>In the <code>deploy</code> step:</p> <ul> <li>substitute <code>env.SUBSCRIPTION-ID</code> with <code>secrets.AZURE_SUBSCRIPTION_ID</code></li> </ul> </li> <li> <p>Commit changes</p> </li> </ul> </li> </ol>"},{"location":"page5/#task-3","title":"Task 3","text":"<ol> <li>Go to <code>Actions</code> menu in Github</li> <li>Go to the URL of the App in the browser</li> </ol>"}]}